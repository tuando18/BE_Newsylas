<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token Information</title>
    <link rel="stylesheet" href="/stylesheets/token.css">
</head>
<body>
    <div class="container">
        <h1>Admin Token Information</h1>

        <div id="token-details" class="token-section">
            <h2>Token Details</h2>
            <!-- Token details will be loaded here -->
        </div>

        <div id="token-accounts" class="token-section">
            <h2>Token Accounts</h2>
            <!-- Token accounts will be loaded here -->
        </div>

        <div id="transaction-history" class="token-section">
            <h2>Transaction History</h2>
            <!-- Transaction history will be loaded here -->
        </div>
    </div>

    <button class="transfer-button" onclick="openTransferModal()">Transfer Token</button>

    <div id="transferModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeTransferModal()">&times;</span>
            <h2>Transfer Token</h2>
            <form id="transferForm">
                <label for="recipient">Recipient Address:</label>
                <input type="text" id="recipient" name="recipient" required>
                <label for="amount">Amount:</label>
                <input type="number" id="amount" name="amount" required>
                <button type="submit">Transfer</button>
            </form>
        </div>
    </div>

    <script>
        async function fetchTokenData() {
            try {
                const response = await fetch('http://localhost:3000/api/v1/tokens/token');
                const data = await response.json();

                // Display token details
                document.getElementById('token-details').innerHTML = `
                    <ul>
                        <li><strong>Name:</strong> ${data.token.name}</li>
                    </ul>
                `;

                // Display token accounts
                if (data.token.tokenAccounts && data.token.tokenAccounts.length > 0) {
                    const accountsTable = `
                        <table>
                            <tbody>
                                ${data.token.tokenAccounts.map(account => `
                                    <tr><td><strong>Address:</strong> ${account.address}</td></tr>
                                    <tr><td><strong>Balance:</strong> ${account.balance}</td></tr>
                                    <tr><td><strong>Mint:</strong> ${account.mint}</td></tr>
                                    <tr><td><strong>Owner:</strong> ${account.owner}</td></tr>
                                    <tr><td colspan="4"><hr /></td></tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    document.getElementById('token-accounts').innerHTML = accountsTable;
                } else {
                    document.getElementById('token-accounts').innerHTML = '<p>No token accounts available.</p>';
                }

                // Display transaction history
                if (data.token.transactionHistory && data.token.transactionHistory.length > 0) {
                    const transactionsTable = `
                        <table>
                            <thead>
                                <tr>
                                    <th>Transaction Signature</th>
                                    <th>Amount</th>
                                    <th>Timestamp</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.token.transactionHistory.map(transaction => `
                                    <tr>
                                        <td>${transaction.signature}</td>
                                        <td>${transaction.amount}</td>
                                        <td>${new Date(transaction.timestamp).toLocaleString()}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    document.getElementById('transaction-history').innerHTML = transactionsTable;
                } else {
                    document.getElementById('transaction-history').innerHTML = '<p>No transaction history available.</p>';
                }
            } catch (error) {
                console.error('Error fetching token data:', error);
                document.getElementById('transaction-history').innerHTML = '<p>Error loading transaction history.</p>';
            }
        }

        function openTransferModal() {
            document.getElementById('transferModal').style.display = "block";
        }

        function closeTransferModal() {
            document.getElementById('transferModal').style.display = "none";
        }

        // Close modal on form submission (handle token transfer logic here)
        document.getElementById('transferForm').addEventListener('submit', function(event) {
            event.preventDefault();
            // Implement the token transfer logic here
            const recipient = document.getElementById('recipient').value;
            const amount = document.getElementById('amount').value;
            console.log(`Transferring ${amount} tokens to ${recipient}`);
            // Call your API to handle the transfer

            // Close modal after transfer
            closeTransferModal();
        });

        // Fetch token data when the page loads
        fetchTokenData();
    </script>
</body>
</html>
